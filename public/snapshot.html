<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Snapshot</title>
	<style>
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
		pre { white-space: pre-wrap; word-wrap: break-word; background: #f6f8fa; padding: 12px; border-radius: 6px; }
		button { padding: 10px 16px; font-size: 14px; cursor: pointer; }
		#deleteBtn { background: #dc3545; color: white; border: none; }
		#deleteBtn:hover { background: #c82333; }
	</style>
</head>
<body>
	<h1 id="snapshotTitle">Snapshot</h1>
	<div style="margin-bottom: 12px; display:flex; gap:8px; align-items:center;">
		<a href="/" style="text-decoration: none; padding: 10px 16px; background: #007bff; color: white; border-radius: 4px;">← Back to Editor</a>
		<button id="copyBtn">Copy</button>
		<button id="deleteBtn">Delete Snapshot</button>
		<span id="status" aria-live="polite"></span>
	</div>
	<pre id="code">Loading…</pre>

	<script>
		function getId() {
			const m = window.location.pathname.match(/\/s\/([^/]+)/);
			return m ? m[1] : null;
		}
		async function load() {
			const id = getId();
			if (!id) { document.getElementById('status').textContent = 'Missing id'; return; }
			try {
				const res = await fetch('/api/snapshot/' + encodeURIComponent(id));
				const data = await res.json();
				if (!res.ok) throw new Error(data.error || 'Failed to fetch');
				document.getElementById('code').textContent = data.code || '';
				document.getElementById('snapshotTitle').textContent = data.name || 'Snapshot';
			} catch (e) {
				document.getElementById('status').textContent = e.message || 'Error loading';
			}
		}
		document.getElementById('copyBtn').addEventListener('click', async () => {
			try {
				await navigator.clipboard.writeText(document.getElementById('code').textContent);
				document.getElementById('status').textContent = 'Copied!';
			} catch (e) {
				document.getElementById('status').textContent = 'Copy failed';
			}
		});
		document.getElementById('deleteBtn').addEventListener('click', async () => {
			const id = getId();
			if (!id) return;
			if (!confirm('Delete this snapshot? This cannot be undone.')) return;
			try {
				const res = await fetch('/api/snapshot/' + encodeURIComponent(id), { method: 'DELETE' });
				if (!res.ok) throw new Error('Failed to delete');
				document.getElementById('status').textContent = 'Deleted!';
				document.getElementById('code').textContent = 'This snapshot has been deleted.';
				document.getElementById('deleteBtn').disabled = true;
			} catch (e) {
				document.getElementById('status').textContent = 'Delete failed';
			}
		});
		load();
	</script>
</body>
</html>
